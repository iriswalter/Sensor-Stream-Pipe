<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sensor Stream Pipe: Sensor Stream Pipe Instalation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="SSP.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Sensor Stream Pipe
   </div>
   <div id="projectbrief">Sensor Stream Pipe</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Sensor Stream Pipe Instalation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="#linux">Linux instructions</a></p>
<p><a href="#windows">Windows instructions</a></p>
<h2>Linux</h2>
<p>To get our Sensor Stream Pipe up and running, you will require the following:</p>
<p>The following steps were tested on Ubuntu 18.04. Installing on other recent Linux distributions should be pretty similar, but please check the installation instructions for OpenCV and Kinect DK on your respective platform first. Installation instructions for Windows should be ready soon. If you encounter any problems or have any suggestions, please let us know by emailing <a href="#" onclick="location.href='mai'+'lto:'+'con'+'ta'+'ct@'+'mo'+'ets'+'i.'+'com'; return false;">conta<span style="display: none;">.nosp@m.</span>ct@m<span style="display: none;">.nosp@m.</span>oetsi<span style="display: none;">.nosp@m.</span>.com</a> or post on our <a href="https://moetsi.com/pages/community">forum</a>.</p>
<h3>Dependencies</h3>
<p>To get our Sensor Stream Pipe up and running, you will require the following:</p>
<ul>
<li><a href="https://opencv.org/">OpenCV</a> 3.2.0 (tested on version available on Ubuntu 18.04 repo) is used for image processing.</li>
<li><a href="https://github.com/libav/libav/">libav</a> 3.4.6 (tested on version available on Ubuntu 18.04 repo) encodes, decodes and processes image frames.</li>
<li><a href="https://uscilab.github.io/cereal/">Cereal</a> 1.2.2 (headers only) serializes data for network transmission.</li>
<li><a href="http://zeromq.org/">ZeroMQ</a> and <a href="https://github.com/zeromq/cppzmq/">cppzmq</a> (libzmq3 4.3.1, cppzmq 4.3.0) perform network and low-level I/O operations.</li>
<li><a href="https://github.com/gabime/spdlog/">spdlog</a> 1.4.1 Logging library.</li>
<li><a href="https://github.com/jbeder/yaml-cpp/">yaml-cpp</a> 0.6.0 reads server configuration files.</li>
<li><a href="https://github.com/catid/Zdepth.git">Zdepth</a>: compresses depth data.</li>
<li><a href="https://github.com/NVIDIA/NvPipe/">NvPipe</a> (<em>optional</em>, but <b>recommended if you have an NVidia GPU</b> ) encodes and decodes frames. This is optional, but recommended for users with Nvidia GPUs.</li>
<li><a href="https://github.com/microsoft/Azure-Kinect-Sensor-SDK/">Azure Kinect SDK</a> 1.3 (to support the Azure Kinect Body Tracking SDK), 1.4 otherwise (<em>optional</em>) accesses Kinect DK data.</li>
<li><a href="https://docs.microsoft.com/bs-cyrl-ba/azure/Kinect-dk/body-sdk-download/">Azure Kinect Body Tracking SDK</a> 1.0 (<em>optional</em>) SSP Body Tracking client.</li>
</ul>
<h3>Download and install repo libraries</h3>
<h4>OpenCV 3.2.0</h4>
<div class="fragment"><div class="line">sudo apt install libopencv-dev libopencv-core-dev uuid-dev</div></div><!-- fragment --> <h4>Libav 3.4.6</h4>
<div class="fragment"><div class="line">sudo apt install libavformat-dev libavutil-dev libavcodec-dev libavfilter-dev</div></div><!-- fragment --><h3>Download and extract "out-of-repo" libraries</h3>
<p>First, create a folder where local libs are to be installed:</p>
<div class="fragment"><div class="line">mkdir ~/libs</div><div class="line">mkdir ~/libs/srcOriginal</div></div><!-- fragment --><h4>Cereal 1.2.2</h4>
<div class="fragment"><div class="line">cd ~/libs/srcOriginal</div><div class="line">wget https://codeload.github.com/USCiLab/cereal/tar.gz/v1.2.2</div><div class="line">tar xf v1.2.2</div><div class="line">cp -r cereal-1.2.2/include ~/libs</div></div><!-- fragment --><h4>ZeroMQ</h4>
<h5>libzmq3 4.3.1</h5>
<div class="fragment"><div class="line">cd ~/libs/srcOriginal</div><div class="line">wget https://github.com/zeromq/libzmq/releases/download/v4.3.1/zeromq-4.3.1.tar.gz</div><div class="line">tar xf zeromq-4.3.1.tar.gz</div><div class="line">cd zeromq-4.3.1</div><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">cmake .. -DCMAKE_INSTALL_PREFIX=~/libs</div><div class="line">make install -j4</div></div><!-- fragment --><p>If you want to take advantage of ZMQ pulling support to check for new frames, compile ZMQ and CPPZMQ with the <a href="https://github.com/zeromq/cppzmq/issues/175">draft API suppport</a>. Replace the cmake line with:</p>
<div class="fragment"><div class="line">cmake .. -DENABLE_DRAFTS=ON -DCMAKE_INSTALL_PREFIX=~/libs</div></div><!-- fragment --><p>Also, you must set SSP_WITH_ZMQ_POLLING at SSP build time.</p>
<h5>cppzmq 4.3.0</h5>
<div class="fragment"><div class="line">cd ~/libs/srcOriginal</div><div class="line">wget https://github.com/zeromq/cppzmq/archive/v4.3.0.tar.gz</div><div class="line">tar xf v4.3.0.tar.gz</div><div class="line">cd cppzmq-4.3.0</div><div class="line">cp *.hpp ~/libs/include</div></div><!-- fragment --><h4>yaml-cpp 0.6.0</h4>
<div class="fragment"><div class="line">cd ~/libs/srcOriginal</div><div class="line">wget https://github.com/jbeder/yaml-cpp/archive/yaml-cpp-0.6.0.tar.gz</div><div class="line">tar xf yaml-cpp-0.6.0.tar.gz</div><div class="line">cd yaml-cpp-yaml-cpp-0.6.0</div><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">cmake .. -DCMAKE_INSTALL_PREFIX=~/libs</div><div class="line">make install</div></div><!-- fragment --><h4>Zdepth</h4>
<div class="fragment"><div class="line">cd ~/libs/srcOriginal</div><div class="line">git clone https://github.com/catid/Zdepth.git</div><div class="line">cd Zdepth</div><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">cmake .. -DCMAKE_INSTALL_PREFIX=~/libs</div><div class="line">make install</div><div class="line">cp libzdepth.a ~/libs/lib/</div><div class="line">cp zstd/libzstd.a ~/libs/lib/</div></div><!-- fragment --><h4>spdlog</h4>
<div class="fragment"><div class="line">cd ~/libs/srcOriginal</div><div class="line">wget https://github.com/gabime/spdlog/archive/v1.4.1.tar.gz</div><div class="line">tar xf v1.4.1.tar.gz</div><div class="line">cd spdlog-1.4.1 &amp;&amp; mkdir build &amp;&amp; cd build</div><div class="line">cmake .. -DCMAKE_INSTALL_PREFIX=~/libs</div><div class="line">make -j</div><div class="line">make install</div></div><!-- fragment --><h5>NVPipe (optional, recommended for users with Nvidia GPU)</h5>
<div class="fragment"><div class="line">cd ~/libs/srcOriginal</div><div class="line">git clone https://github.com/NVIDIA/NvPipe.git</div><div class="line">cd NvPipe/</div><div class="line">mkdir build &amp;&amp; cd build</div><div class="line">cmake .. -DCMAKE_INSTALL_PREFIX=~/libs</div><div class="line">make</div><div class="line">make install</div></div><!-- fragment --><h5>Azure Kinect SDK 1.3/4 (optional)</h5>
<p><em>Note: to avoid getting a password prompt, run any command as sudo before starting this section of the tutorial</em></p>
<p>1) Add the Linux Software Repository for Microsoft Products. </p><div class="fragment"><div class="line">curl https://packages.microsoft.com/keys/microsoft.asc | sudo apt-key add -</div><div class="line">sudo apt-add-repository https://packages.microsoft.com/ubuntu/18.04/prod</div><div class="line">sudo apt-get update</div></div><!-- fragment --><p>2) Install Azure Kinect SDK 1.3 (change 1.3 to 1.4 if you do not need body tracking) </p><div class="fragment"><div class="line">sudo apt install libk4a1.3 libk4a1.3-dev</div></div><!-- fragment --><p>3) To be able to use the Kinect as non-root, please run the following: </p><div class="fragment"><div class="line">wget https://raw.githubusercontent.com/microsoft/Azure-Kinect-Sensor-SDK/develop/scripts/99-k4a.rules</div><div class="line">sudo cp 99-k4a.rules /etc/udev/rules.d/</div></div><!-- fragment --><p>4 a) If using 1.4, in the current package, the link to the canonical version of the depth lib is missing. You can create it by running the following command:</p>
<div class="fragment"><div class="line">sudo ln -s /usr/lib/x86_64-linux-gnu/libk4a1.4/libdepthengine.so.2.0 /usr/lib/x86_64-linux-gnu/libdepthengine.so</div></div><!-- fragment --><p>4 a) If using 1.3, the depth engine is missing from the package. Microsoft is aware of the problem, but it only corrected it in 1.4.</p>
<p><a href="https://github.com/microsoft/Azure-Kinect-Sensor-SDK/blob/develop/docs/depthengine.md">https://github.com/microsoft/Azure-Kinect-Sensor-SDK/blob/develop/docs/depthengine.md</a></p>
<p>You can get the libdepthengine.so.2.0 file from the package at <a href="https://packages.microsoft.com/ubuntu/18.04/prod/pool/main/libk/libk4a1.4/libk4a1.4_1.4.1_amd64.deb">https://packages.microsoft.com/ubuntu/18.04/prod/pool/main/libk/libk4a1.4/libk4a1.4_1.4.1_amd64.deb</a>. Open with Archive Manager (or equivalent), the file is in (data/./usr/lib/x86_64-linux-gnu/libk4a1.4/), and extract it to <code>~/libs/lib</code>. You can then perform an equivalent command as above.</p>
<div class="fragment"><div class="line">cd ~/libs/lib</div><div class="line">ln -s libdepthengine.so.2.0 libdepthengine.so</div></div><!-- fragment --><h5>Azure Kinect Body Tracking SDK (optional)</h5>
<p>Check instructions above to add the Linux Software Repository for Microsoft Products and then do:</p>
<div class="fragment"><div class="line">sudo apt install libk4abt1.0-dev</div></div><!-- fragment --><h4>Building Sensor Stream Pipe</h4>
<p>Download and build the project (the ssp_server, ssp_client and ssp_tester):</p>
<div class="fragment"><div class="line">git clone git@github.com:moetsi/Sensor-Stream-Pipe.git</div><div class="line">cd Sensor-Stream-Pipe</div><div class="line">mkdir build</div><div class="line">cd build</div><div class="line">cmake .. -DSSP_WITH_KINECT_SUPPORT=OFF -DSSP_WITH_K4A_BODYTRACK=OFF -DSSP_WITH_NVPIPE_SUPPORT=OFF</div><div class="line">make</div></div><!-- fragment --><p>You can turn on Kinect, Bodytrack and NVPipe support by adding the following to the <code>cmake ..</code> line respectively:</p>
<div class="fragment"><div class="line">-DSSP_WITH_KINECT_SUPPORT=ON </div><div class="line">-DSSP_WITH_K4A_BODYTRACK=ON</div><div class="line">-DSSP_WITH_NVPIPE_SUPPORT=ON</div></div><!-- fragment --><h2>Windows</h2>
<p>Windows installation process was performed using <a href="https://docs.microsoft.com/en-us/cpp/build/vcpkg?view=msvc-160">vcpkg</a> to install most dependencies. Tested on Windows 10 Build 19041, Visual Studio 2019 Community Edition (VS).</p>
<p>This process may also work for Linux, but this was not tested.</p>
<h3>Install vcpkg</h3>
<p>Follow vcpkg installation instructions available <a href="https://docs.microsoft.com/en-us/cpp/build/install-vcpkg?view=msvc-160&amp;tabs=windows">here</a></p>
<h3>Install dependencies available on vcpkg</h3>
<p>Install dependencies using vcpkg.</p>
<div class="fragment"><div class="line">vcpkg install azure-kinect-sensor-sdk:x64-windows cereal:x64-windows cppzmq:x64-windows ffmpeg:x64-windows opencv3:x64-windows spdlog:x64-windows yaml-cpp:x64-windows zeromq:x64-windows</div></div><!-- fragment --><h3>Build and install remaining dependecies</h3>
<p>Prepare a directory to place the remaining dependecies lib and include files (refered henceforth as <code>$LIBS</code>). This directory should have a <code>lib</code> and <code>include</code> subfolders with the corresponding <code>.lib</code> and headers respectively.</p>
<h4>Zdepth</h4>
<p>Clone Zdepth repo</p>
<div class="fragment"><div class="line">git clone https://github.com/catid/Zdepth.git</div></div><!-- fragment --><p>Open CMakeLists file in VS and build accorcing to your desired profile (x86 or x64; Debug or Release).</p>
<p>If you did not specify an install dir during the CMake configuration, copy the <code>Zdepth\include</code> and output lib folders (e.g. <code>ZDepth\out\*</code>) to <code>$LIBS</code>.</p>
<h4>Azure Kinect Body Tracking SDK (optional)</h4>
<p>Install Azure Body Tracker SDK from the instructions available <a href="https://www.microsoft.com/en-us/download/details.aspx?id=100942">here</a>.</p>
<p>Copy the SDK include and lib files from the SDK install list to <code>$LIBS</code>, or add the SDK path to SSP CMakeLists (see below)</p>
<h4>Building Sensor Stream Pipe</h4>
<p>Clone the SSP repo</p>
<div class="fragment"><div class="line">git clone git@github.com:moetsi/Sensor-Stream-Pipe.git</div></div><!-- fragment --><p>Due to the diferences in the build process, the Windows CMake file is named CMakeListsWindows.txt at the root of the SSP repo.</p>
<p>Thus, you shoud delete CMakeLists.txt and rename CMakeListsWindows.txt to CMakeLists.txt.</p>
<p>Open CMakeLists.txt in VS.</p>
<p>Replace/Add the include ("C://Users//Andre//source//repos//vcpkg//installed//x64-windows//include") and link paths ("C://Users//Andre//source//repos//vcpkg//installed//x64-windows//lib") at the top of the file with your <code>$LIBS</code> paths</p>
<div class="fragment"><div class="line">include_directories(&quot;C://Users//Andre//source//repos//vcpkg//installed//x64-windows//include&quot;)</div><div class="line">link_directories(&quot;C://Users//Andre//source//repos//vcpkg//installed//x64-windows//lib&quot;)</div></div><!-- fragment --><p>You can also add your <code>vcpkg//installed//</code> dir to the include and link paths.</p>
<p>After replacing the paths, set the desired compile options (SSP_WITH_KINECT_SUPPORT, SSP_WITH_K4A_BODYTRACK, ...), regenerate CMakeCache and build the project.</p>
<h4>Linking errors?</h4>
<p>if you have linking errors (missing .lib files), try replacing the short lib name with the full lib path in CMake: "libzmq" -&gt; "C:/Users/Andre/source/repos/vcpkg/installed/x64-windows/lib/libzmq.lib" </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
